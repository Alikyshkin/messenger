# –ß–µ–∫-–ª–∏—Å—Ç —Ñ–∏—á –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞

–°—Ç–∞—Ç—É—Å: **–µ—Å—Ç—å** / **—á–∞—Å—Ç–∏—á–Ω–æ** / **–Ω–µ—Ç** / **–¥–æ–ø–∏–ª–∏—Ç—å**

---

## 1. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –û–¥–∏–Ω–∞–∫–æ–≤–∞—è –∏—Å—Ç–æ—Ä–∏—è —á–∞—Ç–æ–≤ –∏ –º–µ–¥–∏–∞ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö | **–ß–∞—Å—Ç–∏—á–Ω–æ** | –ï—Å—Ç—å API `/sync/messages`, –ª–æ–∫–∞–ª—å–Ω–∞—è SQLite, WebSocket –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π. –ù—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ª–Ω–æ—Ç—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–¥–∏–∞ –∏ —Å–∫–æ—Ä–æ—Å—Ç—å. |
| –ë—ã—Å—Ç—Ä–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —Å–æ–æ–±—â–µ–Ω–∏–π (read_at, delivered) –∏ –∑–≤–æ–Ω–∫–æ–≤ | **–ß–∞—Å—Ç–∏—á–Ω–æ** | `read_at` –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ PATCH, WebSocket —Ä–∞—Å—Å—ã–ª–∞–µ—Ç `new_message`. Real-time –¥–æ—Å—Ç–∞–≤–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–¥–µ—Ä–∂–∫–∏. |

---

## 2. –£–ª—É—á—à–µ–Ω–Ω—ã–π UX —á–∞—Ç–æ–≤

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ —Ç–µ–∫—Å—Ç–∞ (typing) | **–ù–µ—Ç** | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. –ù—É–∂–µ–Ω WebSocket-—Å–æ–±—ã—Ç–∏–µ `typing` –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ UI. |
| –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä ¬´–ø–µ—á–∞—Ç–∞–µ—Ç/–ø–µ—á–∞—Ç–∞—é—Ç¬ª –¥–ª—è –≥—Ä—É–ø–ø | **–ù–µ—Ç** | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |
| –ü–æ–∫–∞–∑ ¬´—Å–æ–±–µ—Å–µ–¥–Ω–∏–∫ –æ–Ω–ª–∞–π–Ω¬ª / ¬´–ø–µ—á–∞—Ç–∞–µ—Ç¬ª –Ω–∞ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö | **–ß–∞—Å—Ç–∏—á–Ω–æ** | `is_online` –∏ `user_status` —á–µ—Ä–µ–∑ WebSocket –µ—Å—Ç—å. `last_seen` –≤ API –µ—Å—Ç—å, –Ω–æ **–Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI** (—Å–º. audit_report). ¬´–ü–µ—á–∞—Ç–∞–µ—Ç¬ª ‚Äî –Ω–µ—Ç. |

---

## 3. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –ü–æ–∏—Å–∫ –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º (—Ç–µ–∫—Å—Ç –ø–æ –∏—Å—Ç–æ—Ä–∏–∏) | **–ï—Å—Ç—å** | FTS5: `/search/messages`, `/search/group-messages`. –ö–ª–∏–µ–Ω—Ç: `search_chats_screen.dart`. |
| –§–∏–ª—å—Ç—Ä –ø–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é | **–ß–∞—Å—Ç–∏—á–Ω–æ** | –ü–∞—Ä–∞–º–µ—Ç—Ä `peerId` —Å—É–∂–∞–µ—Ç –ø–æ–∏—Å–∫ –¥–æ —á–∞—Ç–∞. –û—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞ ¬´—Ç–æ–ª—å–∫–æ –æ—Ç X¬ª –Ω–µ—Ç. |
| –§–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞ (–º–µ–¥–∏–∞/—Ñ–∞–π–ª—ã/—Å—Å—ã–ª–∫–∏) | **–ß–∞—Å—Ç–∏—á–Ω–æ** | `/media/:peerId` –∏ `/media/groups/:groupId` —Å `type=image|video|file`. –í –æ–±—â–µ–º –ø–æ–∏—Å–∫–µ ‚Äî –Ω–µ—Ç. |

---

## 4. –†–µ–∞–∫—Ü–∏–∏ –∏ —Å—Ç–∏–∫–µ—Ä—ã

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (–ª–∞–π–∫–∏/—ç–º–æ–¥–∑–∏) | **–ï—Å—Ç—å** | `POST /messages/:id/reaction`, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞–±–æ—Ä —ç–º–æ–¥–∑–∏ (üëçüëé‚ù§Ô∏èüî•üòÇüòÆüò¢). |
| –°—Ç–∏–∫–µ—Ä—ã | **–ù–µ—Ç** | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |
| GIF | **–ß–∞—Å—Ç–∏—á–Ω–æ** | GIF –∫–∞–∫ —Ñ–∞–π–ª/–∫–∞—Ä—Ç–∏–Ω–∫–∞ ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è. –û—Ç–¥–µ–ª—å–Ω–æ–≥–æ GIF-–ø–∞–∫–∞/–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (GIPHY –∏ —Ç.–ø.) –Ω–µ—Ç. |
| –ö–∞—Å—Ç–æ–º–Ω—ã–µ —ç–º–æ–¥–∑–∏-—Ä–µ–∞–∫—Ü–∏–∏ | **–ß–∞—Å—Ç–∏—á–Ω–æ** | –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä (`ALLOWED_REACTION_EMOJIS`). –†–∞—Å—à–∏—Ä—è–µ–º—ã–π –Ω–∞–±–æ—Ä ‚Äî –Ω–µ—Ç. |

---

## 5. –ò—Å—á–µ–∑–∞—é—â–∏–µ / —Å–µ–∫—Ä–µ—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∞–π–º–µ—Ä–æ–º (—Å–∞–º–æ—É–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ) | **–ù–µ—Ç** | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |
| –°–µ–∫—Ä–µ—Ç–Ω—ã–µ/—Å–∫–≤–æ–∑–Ω—ã–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–µ —á–∞—Ç—ã | **–ï—Å—Ç—å** | E2EE: `E2EEService`, `sender_public_key`, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π. |

---

## 6. –ö–∞–Ω–∞–ª—ã / —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–µ —á–∞—Ç—ã

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –û–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–µ–µ –≤–µ—â–∞–Ω–∏–µ (–∞–¥–º–∏–Ω –ø–∏—à–µ—Ç, –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ —á–∏—Ç–∞—é—Ç) | **–ù–µ—Ç** | –¢–æ–ª—å–∫–æ –≥—Ä—É–ø–ø—ã —Å –¥–≤—É—Å—Ç–æ—Ä–æ–Ω–Ω–∏–º –æ–±—â–µ–Ω–∏–µ–º. |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∞–≤ (–∫—Ç–æ –º–æ–∂–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å/–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å) | **–ù–µ—Ç** | –†–æ–ª–∏ –≤ –≥—Ä—É–ø–ø–∞—Ö –Ω–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –ø–æ–¥ –∫–∞–Ω–∞–ª—ã. |

---

## 7. –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –°–∫—Ä—ã—Ç–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∏–∑–∏—Ç–∞, –∞–≤–∞—Ç–∞—Ä–∞, —Å—Ç–∞—Ç—É—Å–∞ –æ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≥—Ä—É–ø–ø | **–ß–∞—Å—Ç–∏—á–Ω–æ** | `who_can_see_status`: contacts / nobody / all. –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–æ—Å—Ç—å ¬´–æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π¬ª ‚Äî –Ω–µ—Ç. |
| –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ¬´–∫—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ —á–∞—Ç/–∫–∞–Ω–∞–ª/–¥—Ä—É–∑—å—è¬ª | **–ß–∞—Å—Ç–∏—á–Ω–æ** | –ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è –µ—Å—Ç—å. ¬´–ö—Ç–æ –º–æ–∂–µ—Ç –¥–æ–±–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É¬ª ‚Äî –Ω–µ—Ç. |

---

## 8. –û—Ç–ø—Ä–∞–≤–∫–∞ –≥–æ–ª–æ—Å–∞ –∏ –≤–∏–¥–µ–æ-—Å–æ–æ–±—â–µ–Ω–∏–π

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –í–æ–π—Å-–º–µ—Å—Å—ã (–≥–æ–ª–æ—Å–æ–≤—ã–µ) | **–ï—Å—Ç—å** | `attachment_kind: voice`, –∑–∞–ø–∏—Å—å —á–µ—Ä–µ–∑ `record`, –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ `just_audio`. |
| –ö–æ—Ä–æ—Ç–∫–∏–µ –≤–∏–¥–µ–æ-–∑–∞–º–µ—Ç–∫–∏ (video note) | **–ï—Å—Ç—å** | `attachment_kind: video_note`, `RecordVideoNoteScreen`, `VideoNoteBubble`. |

---

## 9. –õ–æ–∫–∞—Ü–∏—è

| –§–∏—á–∞ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------|--------|-------------|
| –®–µ—Ä–∏–Ω–≥ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ / –ª–∞–π–≤-–ª–æ–∫–∞—Ü–∏–∏ –≤ —á–∞—Ç–µ | **–ù–µ—Ç** | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ. |

---

## –°–≤–æ–¥–∫–∞: –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –Ω–∞ –¥–æ—Ä–∞–±–æ—Ç–∫—É

| –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –§–∏—á–∞ | –û—Ü–µ–Ω–∫–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ |
|-----------|------|------------------|
| P0 | Typing indicator (–ª–∏—á–Ω—ã–µ —á–∞—Ç—ã) | –ù–∏–∑–∫–∞—è |
| P0 | –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ `last_seen` –≤ UI | –ù–∏–∑–∫–∞—è |
| P1 | Typing –≤ –≥—Ä—É–ø–ø–∞—Ö | –°—Ä–µ–¥–Ω—è—è |
| P1 | –§–∏–ª—å—Ç—Ä—ã –≤ –ø–æ–∏—Å–∫–µ (–ø–æ —Ç–∏–ø—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞, –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—é) | –°—Ä–µ–¥–Ω—è—è |
| P1 | –°–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∞–π–º–µ—Ä–æ–º | –í—ã—Å–æ–∫–∞—è |
| P2 | –°—Ç–∏–∫–µ—Ä—ã | –í—ã—Å–æ–∫–∞—è |
| P2 | –ö–∞–Ω–∞–ª—ã / broadcast | –í—ã—Å–æ–∫–∞—è |
| P2 | –®–µ—Ä–∏–Ω–≥ –ª–æ–∫–∞—Ü–∏–∏ | –°—Ä–µ–¥–Ω—è—è |
| P2 | –ì—Ä–∞–Ω—É–ª—è—Ä–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å (—Å–∫—Ä—ã—Ç—å –æ—Ç X) | –°—Ä–µ–¥–Ω—è—è |
