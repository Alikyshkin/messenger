# План автоматизированного тестирования мессенджера

Стратегия + уровни тестов + приоритетные сценарии.

---

## 1. Цели и область автоматизации

### Основные цели

- **Быстрое регрессионное покрытие** ключевых сценариев (логин, чат, звонки, уведомления)
- **Раннее выявление критических багов** в core-функционале при каждом билде (CI)

### Область автоматизации

| Платформа | Приоритет |
|-----------|-----------|
| Web-клиент | Высокий |
| Мобильные приложения (iOS/Android) | Высокий |
| Desktop (при необходимости) | Средний |

### Критические business-flows

- Регистрация / логин
- Отправка и получение сообщений
- Push-уведомления
- Аудио- и видеозвонки

---

## 2. Стратегия и уровни тестирования

### 2.1 Unit-тесты

**Где:** бекенд (Node.js), клиентская логика (Dart/Flutter)

**Что покрывать:**

- Валидация данных (схемы, форматы)
- Формат сообщений (JSON, E2EE)
- Бизнес-правила отправки/доставки
- Утилиты (форматирование, парсинг)

### 2.2 API-автотесты

**Что покрывать:**

- Авторизация (JWT, OAuth)
- CRUD пользователей
- Создание и получение чатов
- Отправка и получение сообщений
- Статусы сообщений (read_at, delivered)
- Friends API (заявки, контакты, блокировка)

### 2.3 UI-автотесты (Web + Mobile)

**Что покрывать:**

- Основные пользовательские сценарии по интерфейсу
- E2E-тесты «от входа до доставки сообщения/звонка»

### 2.4 Нагрузочные и перф-тесты

**Что покрывать:**

- Массовая отправка сообщений
- Параллельные сессии
- Устойчивость real-time канала (WebSocket)

---

## 3. Инструменты и окружения

| Тип тестов | Инструменты |
|------------|-------------|
| API | Postman/Newman, REST Assured, Karate или собственный фреймворк |
| Web UI | Playwright, Cypress или Selenium |
| Mobile UI | Appium, Detox, Espresso/XCUITest (нативные) |
| Нагрузочные | JMeter, Gatling, Locust |

### Запуск

- **CI/CD:** GitLab CI, GitHub Actions, Jenkins
- **Режим:** смок и регресс на каждом билде или nightly

---

## 4. Приоритетные автоматизируемые сценарии

### 4.1 Регистрация и логин

| Сценарий | Приоритет |
|----------|-----------|
| Успешная регистрация (валидные данные, подтверждение) | P0 |
| Логин с валидными/невалидными кредами | P0 |
| Восстановление пароля | P1 |
| Сохранение сессии и logout | P0 |

### 4.2 Профиль и друзья

| Сценарий | Приоритет |
|----------|-----------|
| Просмотр и редактирование профиля | P1 |
| Поиск пользователя, отправка/принятие заявки в друзья | P0 |
| Блокировка пользователя и проверка блокировки сообщений/звонков | P0 |

### 4.3 Чаты и сообщения

| Сценарий | Приоритет |
|----------|-----------|
| Создание 1-на-1 чата, отправка текста, медиа, файлов | P0 |
| Проверка статусов (отправлено/доставлено/прочитано) на 2 клиентах | P0 |
| Редактирование и удаление сообщения | P1 |
| Цитирование, ответ, пересылка | P1 |
| Поиск по чатам, закрепление чатов | P2 |

### 4.4 Уведомления

| Сценарий | Приоритет |
|----------|-----------|
| Push при новом сообщении в фоне/при заблокированном экране | P0 |
| Настройки уведомлений (mute чата, глобальный DND) | P1 |

### 4.5 Аудио- и видеозвонки

| Сценарий | Приоритет |
|----------|-----------|
| Исходящий аудиозвонок: звонящий и принимающий клиент (эмуляция двух устройств) | P0 |
| Принятие/отмена, завершение звонка | P0 |
| Видеозвонок: вкл/выкл камеры, смена камеры, переход в аудио-режим | P1 |
| Устойчивость при смене сети/сворачивании | P1 |

---

## 5. Архитектура автотестов

### 5.1 Общий подход

- **Модульная архитектура:** отдельные блоки для логина, чатов, звонков, переиспользуемые в разных сценариях
- **Data-driven:** сценарии задаются через данные (JSON/CSV) для расширения покрытия без изменения кода

### 5.2 Структура

```
tests/
├── core/                    # API-клиенты, хелперы
│   ├── api_client.js
│   ├── user_factory.js
│   └── chat_helpers.js
├── ui/
│   ├── pages/               # Page Object / Screen Object
│   │   ├── LoginPage
│   │   ├── ChatsPage
│   │   ├── ChatPage
│   │   ├── ProfilePage
│   │   └── CallScreen
│   └── flows/
│       ├── login_flow.js
│       └── chat_flow.js
├── config/
│   ├── environments.js      # dev, stage, prod
│   └── users.json           # тестовые пользователи
└── data/
    └── scenarios.json       # data-driven сценарии
```

### 5.3 Конфигурация

- Окружения: dev, stage, prod
- Варианты пользователей (созданные, с заявками)
- Фич-флаги (E2EE, push, звонки)

---

## 6. План запуска и регресса

### 6.1 Смок-сьют

**Запуск:** на каждом коммите/PR

**Состав:**

- Логин
- Отправка и получение сообщения
- Один звонок (аудио)
- Одно уведомление

### 6.2 Основной регресс

**Запуск:** nightly или перед релизом

**Состав:**

- Расширенный набор критических сценариев из раздела 4

### 6.3 Нагрузочные прогоны

**Запуск:** по расписанию (например, раз в неделю) или перед крупными релизами

---

## 7. Отчётность и поддержка

### 7.1 Отчёты

- Allure / HTML-отчёты
- Интеграция с CI (статус, логи, скриншоты/видео упавших тестов)

### 7.2 Метрики

- Покрытие ключевых сценариев автоматизацией
- Время прогона
- Стабильность тестов (flaky rate)

### 7.3 Поддержка

- Регулярный рефакторинг тестов
- Актуализация под изменения UI/API

---

## 8. Правило внедрения

> **Сначала автоматизируем один сквозной критичный поток, потом расширяем глубину.**

Рекомендуемый первый поток: **Логин → Создание чата → Отправка сообщения → Получение сообщения (2 клиента)**.
